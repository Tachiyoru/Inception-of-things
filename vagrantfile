#export VAGRANT_HOME=$HOME/sgoinfre/vagrant
#before vagrant up

# Define CPU and RAM here if needed
CPU = 8         # Number of CPUs
RAM = 8192      # Memory in MB (5 GB)

Vagrant.configure("2") do |config|
  NODES = [
    { :hostname => "vmiot", :ip => "192.168.63.10", :cpus => CPU, :mem => RAM }
  ]

  # Run installation for each node
  NODES.each do |node|
    config.vm.define node[:hostname] do |cfg|

      cfg.vm.box = "sethomas/vmiot"
      cfg.vm.box_version = "1.1"
      cfg.vm.hostname = node[:hostname]
      cfg.vm.network "private_network", ip: node[:ip]
  
      # Configure provider-specific settings
      cfg.vm.provider "virtualbox" do |v|
        v.name = node[:hostname]
        v.cpus = node[:cpus]
        v.memory = node[:mem]
        v.customize ['modifyvm', :id, '--nested-hw-virt', 'on']
        v.gui = true
        v.linked_clone = true
      end

      # Sync folder between host and VM
      cfg.vm.synced_folder "./P1/", "/home/vagrant/P1/", create: true
      cfg.vm.synced_folder "./P2/", "/home/vagrant/P2/", create: true
      cfg.vm.synced_folder "./P3/", "/home/vagrant/P3/", create: true
      cfg.vm.synced_folder "./bonus/", "/home/vagrant/bonus/", create: true
      
      # Create SSH-Key to clone from vogsphere
      # cfg.vm.provision :shell do |shell|
      #   shell.path = "scripts/ssh-keygen.sh"
      # end    
    
    end
  end
end